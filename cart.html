<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø³Ù„Ø© Ø§Ù„ØªØ³ÙˆÙ‚ | Ù…ØªØ¬Ø± DRS BOUTIQUE</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <div class="container">
      <h1>Ù…ØªØ¬Ø± DRS BOUTIQUE</h1>
      <button class="nav-toggle" aria-label="Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©" style="display:none;">
        <span style="font-size:1.7em;">&#9776;</span>
      </button>
      <nav>
        <ul>
          <li><a href="index.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
          <li><a href="catalog.html">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</a></li>
          <li><a href="cart.html" class="active">Ø§Ù„Ø³Ù„Ø©</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main>
    <section class="cart-section">
      <h2>Ø³Ù„Ø© Ø§Ù„ØªØ³ÙˆÙ‚</h2>
      <div class="cart-table-container">
        <div class="cart-list"></div>
        <div id="cart-summary-advanced" class="cart-summary-advanced">
          <span class="cart-summary-icon">ğŸ›’</span>
          <span class="cart-summary-label">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:</span>
          <span class="cart-summary-count">0</span>
          <span class="cart-summary-label" style="margin-right:22px;">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ:</span>
          <span class="cart-summary-total">0 Ø¯.Ù„</span>
          <button id="clear-cart-btn" class="checkout-btn" style="margin-right:18px;">ØªÙØ±ÙŠØº Ø§Ù„Ø³Ù„Ø©</button>
        </div>
      </div>

      <div style="text-align:center; margin:18px 0; position:relative;">
        <button class="share-cart-btn" id="shareCartBtn">
          <span style="font-size:1.3em;vertical-align:middle;">&#128257;</span>
          Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø³Ù„Ø©
        </button>
        <div id="shareMenu" class="share-menu" style="display:none;">
          <button id="copyCartLink">Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ø³Ù„Ø©</button>
          <a id="waShare" href="#" target="_blank">Ù…Ø´Ø§Ø±ÙƒØ© Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</a>
          <a id="snapShare" href="#" target="_blank">Ù…Ø´Ø§Ø±ÙƒØ© Ø¹Ø¨Ø± Ø³Ù†Ø§Ø¨ Ø´Ø§Øª</a>
          <a id="twShare" href="#" target="_blank">Ù…Ø´Ø§Ø±ÙƒØ© Ø¹Ø¨Ø± ØªÙˆÙŠØªØ±</a>
          <a id="fbShare" href="#" target="_blank">Ù…Ø´Ø§Ø±ÙƒØ© Ø¹Ø¨Ø± ÙÙŠØ³Ø¨ÙˆÙƒ</a>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <div class="container">
      <p>&copy; 2025 Ù…ØªØ¬Ø± DRS BOUTIQUE. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.</p>
    </div>
  </footer>

  <script>
  // ---------------------- Ø¯ÙˆØ§Ù„ Ø§Ù„Ø³Ù„Ø© ----------------------
  function loadCartFromStorage() {
    const cartList = document.querySelector('.cart-list');
    let items = [];
    const params = new URLSearchParams(window.location.search);
    const sharedCart = params.get("cart");
    if (sharedCart) {
      try { items = JSON.parse(atob(sharedCart)); } catch(e){ items = []; }
    } else {
      try { items = JSON.parse(localStorage.getItem('drs_cart') || '[]'); } catch(e){ items = []; }
    }

    cartList.innerHTML = '';
    if (items.length === 0) {
      cartList.innerHTML = '<div style="text-align:center;color:#b26a00;font-size:1.1em;margin:30px 0;">Ø³Ù„ØªÙƒ ÙØ§Ø±ØºØ©! Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ³ÙˆÙ‚ Ø§Ù„Ø¢Ù†.</div>';
    }

    items.forEach(item => {
      const card = document.createElement('div');
      card.className = 'cart-item-card';
      card.innerHTML = `
        <img src="${item.img}" alt="Ù…Ù†ØªØ¬" class="cart-item-img">
        <div class="cart-item-details">
          <div class="cart-item-meta">
            ${item.size ? `<span>Ø§Ù„Ù…Ù‚Ø§Ø³: 
              <select class="cart-size-select">
                <option value="S"${item.size==='S'?' selected':''}>S</option>
                <option value="M"${item.size==='M'?' selected':''}>M</option>
                <option value="L"${item.size==='L'?' selected':''}>L</option>
                <option value="XL"${item.size==='XL'?' selected':''}>XL</option>
              </select></span>` : ''}
            ${item.color ? `<span>Ø§Ù„Ù„ÙˆÙ†: 
              <select class="cart-color-select">
                <option value="ÙˆØ±Ø¯ÙŠ"${item.color==='ÙˆØ±Ø¯ÙŠ'?' selected':''}>ÙˆØ±Ø¯ÙŠ</option>
                <option value="Ø£Ø²Ø±Ù‚"${item.color==='Ø£Ø²Ø±Ù‚'?' selected':''}>Ø£Ø²Ø±Ù‚</option>
                <option value="Ø£Ø³ÙˆØ¯"${item.color==='Ø£Ø³ÙˆØ¯'?' selected':''}>Ø£Ø³ÙˆØ¯</option>
                <option value="Ø±Ù…Ø§Ø¯ÙŠ"${item.color==='Ø±Ù…Ø§Ø¯ÙŠ'?' selected':''}>Ø±Ù…Ø§Ø¯ÙŠ</option>
              </select></span>` : ''}
          </div>
          <div class="cart-item-prices">
            <span class="cart-item-old-price">${item.oldPrice} Ø¯.Ù„</span>
            <span class="cart-item-new-price">${item.newPrice} Ø¯.Ù„</span>
          </div>
          <div class="cart-item-qty">Ø§Ù„ÙƒÙ…ÙŠØ©: <input type="number" value="${item.qty}" min="1"></div>
          <div class="cart-item-total">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${parseFloat(item.newPrice)*parseInt(item.qty)} Ø¯.Ù„</div>
        </div>
        <button class="cart-item-remove">&#10006;</button>
      `;
      activateCartCardFeatures(card);
      cartList.appendChild(card);
    });
    updateCartSummary();
  }

  function activateCartCardFeatures(card) {
    const removeBtn = card.querySelector('.cart-item-remove');
    if (removeBtn) removeBtn.onclick = function(){ card.remove(); saveCartToStorage(); loadCartFromStorage(); };

    const qtyInput = card.querySelector('.cart-item-qty input');
    const newPriceSpan = card.querySelector('.cart-item-new-price');
    const totalDiv = card.querySelector('.cart-item-total');
    if(qtyInput && newPriceSpan && totalDiv){
      qtyInput.oninput = function(){
        let qty = parseInt(qtyInput.value);
        if(isNaN(qty)||qty<1){ qty=1; qtyInput.value=1; }
        let price = parseFloat(newPriceSpan.textContent) || 0;
        totalDiv.textContent = 'Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ' + (qty*price) + ' Ø¯.Ù„';
        saveCartToStorage();
        updateCartSummary();
      };
    }

    const sizeSelect = card.querySelector('.cart-size-select');
    if(sizeSelect) sizeSelect.onchange = function(){ saveCartToStorage(); };

    const colorSelect = card.querySelector('.cart-color-select');
    const img = card.querySelector('.cart-item-img');
    if(colorSelect && img){
      colorSelect.onchange = function(){
        const colorToImg = { 'ÙˆØ±Ø¯ÙŠ':'photo_2025-09-29_22-03-57.jpg', 'Ø£Ø²Ø±Ù‚':'photo_2025-09-29_22-03-56.jpg', 'Ø£Ø³ÙˆØ¯':'photo_2025-09-29_22-03-54.jpg', 'Ø±Ù…Ø§Ø¯ÙŠ':'photo_2025-09-29_22-03-53.jpg'};
        if(colorToImg[colorSelect.value]) img.src=colorToImg[colorSelect.value];
        saveCartToStorage();
      };
    }
  }

  function saveCartToStorage() {
    const cartList = document.querySelector('.cart-list');
    if(!cartList) return;
    const items=[];
    cartList.querySelectorAll('.cart-item-card').forEach(card=>{
      const img = card.querySelector('.cart-item-img')?.src||'';
      const size = card.querySelector('.cart-size-select')?.value||'';
      const color = card.querySelector('.cart-color-select')?.value||'';
      const oldPrice = (card.querySelector('.cart-item-old-price')?.textContent||'').replace(/[^\d.]/g,'');
      const newPrice = (card.querySelector('.cart-item-new-price')?.textContent||'').replace(/[^\d.]/g,'');
      const qty = card.querySelector('.cart-item-qty input')?.value||'1';
      items.push({img,size,color,oldPrice,newPrice,qty});
    });
    localStorage.setItem('drs_cart',JSON.stringify(items));
  }

  function updateCartSummary() {
    let items=[];
    try{ items=JSON.parse(localStorage.getItem('drs_cart')||'[]'); } catch(e){ items=[]; }
    let totalCount=0,totalPrice=0;
    items.forEach(item=>{
      const qty=parseInt(item.qty)||0;
      const price=parseFloat(item.newPrice)||0;
      totalCount+=qty; totalPrice+=qty*price;
    });
    document.querySelector('.cart-summary-count').textContent=totalCount;
    document.querySelector('.cart-summary-total').textContent=totalPrice+' Ø¯.Ù„';
  }

  document.getElementById('clear-cart-btn').onclick=function(){
    localStorage.removeItem('drs_cart'); loadCartFromStorage();
  };

  // ---------------------- Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø³Ù„Ø© ----------------------
  const shareBtn = document.getElementById('shareCartBtn');
  const shareMenu = document.getElementById('shareMenu');
  const copyBtn = document.getElementById('copyCartLink');
  const waShare = document.getElementById('waShare');
  const snapShare = document.getElementById('snapShare');
  const twShare = document.getElementById('twShare');
  const fbShare = document.getElementById('fbShare');
  const cartUrl = window.location.origin + window.location.pathname;

  shareBtn.onclick = e => {
    e.preventDefault();
    shareMenu.style.display = shareMenu.style.display==='block'?'none':'block';
  };
  document.addEventListener('click', e=>{
    if(!shareBtn.contains(e.target) && !shareMenu.contains(e.target)){
      shareMenu.style.display='none';
    }
  });

  // ---------------------- Ø²Ø± Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ù…Ø­Ø³Ù‘Ù† ----------------------
  copyBtn.onclick = async ()=>{
    const items = JSON.parse(localStorage.getItem('drs_cart')||'[]');
    if(items.length===0){ alert("Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©! Ø£Ø¶Ù Ù…Ù†ØªØ¬Ø§Øª Ø£ÙˆÙ„Ø§Ù‹."); return; }

    let encoded='';
    try{ encoded=btoa(JSON.stringify(items)); } catch(e){ alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ±Ù…ÙŠØ² Ø§Ù„Ø³Ù„Ø©!"); return; }
    const shareLink = cartUrl + "?cart=" + encoded;
    try {
      await navigator.clipboard.writeText(shareLink);
      alert("ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· Ø¨Ù†Ø¬Ø§Ø­!\n" + shareLink);
    } catch(e) {
      alert("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ù†Ø³Ø® ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ØŒ Ø§Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· ÙŠØ¯ÙˆÙŠØ§Ù‹:\n" + shareLink);
    }
    // ØªØ­Ø¯ÙŠØ« Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©
    waShare.href = 'https://wa.me/?text=' + encodeURIComponent('Ø³Ù„Ø© Ù…Ø´ØªØ±ÙŠØ§ØªÙŠ: ' + shareLink);
    snapShare.href = 'https://www.snapchat.com/scan?attachmentUrl=' + encodeURIComponent(shareLink);
    twShare.href = 'https://twitter.com/intent/tweet?text=' + encodeURIComponent('Ø³Ù„Ø© Ù…Ø´ØªØ±ÙŠØ§ØªÙŠ: ' + shareLink);
    fbShare.href = 'https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(shareLink);
  };

  window.onload = loadCartFromStorage;
  </script>
</body>
</html>
